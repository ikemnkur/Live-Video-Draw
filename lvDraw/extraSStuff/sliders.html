<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Video Call App</title>
</head>

<body>

    <canvas id="myCanvas" width="500" height="500" style="border:1px solid #000;"></canvas>
    <div id="videoContainer"></div>

    <!-- <canvas id="myCanvas" width="500" height="500" style="border:1px solid #000;"></canvas> -->
    <br>
    <label for="xPosition">X Position:</label>
    <input type="range" id="xPosition" min="0" max="500" value="250">
    <br>
    <label for="yPosition">Y Position:</label>
    <input type="range" id="yPosition" min="0" max="500" value="250">
    <br>
    <label for="scale">Scale (0.5-2):</label>
    <input type="range" id="scale" min="0.5" max="2" value="1" step="0.01">
    <br>
    <label for="rotate">Rotation (0-360):</label>
    <input type="range" id="rotate" min="0" max="360" value="0">

    <script src="https://cdn.jsdelivr.net/peerjs/1.3.1/peer.min.js" ></script>
    <script defer>
        const canvas = document.getElementById('myCanvas');
        const videoContainer = document.getElementById('videoContainer');
        const stream = canvas.captureStream(25);

        const myPeer = new Peer()
        
        const peer = new Peer(undefined, {
            host: 'peerjs-server.herokuapp.com',
            secure: true,
            port: 443
        });

        const peers = {};

        peer.on('open', id => {
            const roomID = prompt("Enter a room ID to join or create:");
            const conn = peer.connect(roomID);
            conn.on('open', () => {
                conn.send(id);
            });
        });

        peer.on('connection', conn => {
            const call = peer.call(conn.peer, stream);
            call.on('stream', userVideoStream => {
                addVideoStream(userVideoStream);
            });
        });

        peer.on('call', call => {
            call.answer(stream);
            call.on('stream', userVideoStream => {
                addVideoStream(userVideoStream);
            });
        });

        function addVideoStream(stream) {
            const video = document.createElement('video');
            video.srcObject = stream;
            video.width = canvas.width / 3;
            video.height = canvas.height / 3;
            video.autoplay = true;
            videoContainer.append(video);
        }

    // The drawing code for the canvas can go here...

    </script>

    <script>
        // const canvas = document.getElementById('myCanvas');
        const ctx = canvas.getContext('2d');

        const xSlider = document.getElementById('xPosition');
        const ySlider = document.getElementById('yPosition');
        const scaleSlider = document.getElementById('scale');
        const rotationSlider = document.getElementById('rotate');

        function drawSquare() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            const x = xSlider.value;
            const y = ySlider.value;
            const scale = scaleSlider.value;
            const rotation = rotationSlider.value;

            const sideLength = 50 * scale;

            ctx.save();

            ctx.translate(x, y);
            ctx.rotate(rotation * Math.PI / 180);

            ctx.beginPath();
            ctx.rect(-sideLength / 2, -sideLength / 2, sideLength, sideLength);
            ctx.fillStyle = 'white';
            ctx.fill();
            ctx.lineWidth = 2;
            ctx.strokeStyle = 'black';
            ctx.stroke();

            ctx.restore();
        }

        xSlider.addEventListener('input', drawSquare);
        ySlider.addEventListener('input', drawSquare);
        scaleSlider.addEventListener('input', drawSquare);
        rotationSlider.addEventListener('input', drawSquare);

        // Initial draw
        drawSquare();
    </script>

</body>

</html>